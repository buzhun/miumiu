问题引入

小 Q 是一个宝石爱好者。

这一天，小 Q 来到了宝石古董店，店家觉得小 Q 是个宝石行家，于是决定和小 Q 玩一个游戏。

游戏是这样的，一共有 n 块宝石，每块宝石在小 Q 心中都有其对应的价值。注意，由于某些宝石质量过于差劲，因此存在只有店家倒贴钱，小 Q 才愿意带走的宝石，即价值可以为负数。

小 Q 可以免费带走一个连续区间中的宝石，比如区间 [1,3] 或区间 [2,4] 中的宝石。

请问小 Q 能带走的最大价值是多少？


问题分析

首先思考最暴力的解法。

枚举所有区间，暴力累加区间中宝石的价值，最后选一个价值最大的区间。时间复杂度 O(n^3)。

O(n^3) 显然有些无法接受，因此想想有没有办法优化，比如优化掉暴力累加的部分。

优化 1.0

仔细思考不难发现，我们可以枚举区间右端点，然后固定右端点，左端点不断向左移动，边移动边累加，就可以将时间复杂度优化到 O(n^2)。

例如我们固定右端点是 3，那么左端点就从 3 移动到 1，边移动边累加答案，就可以在移动过程中计算出区间 [3,3]、[2,3]、[1,3] 的答案了。因此枚举所有区间右端点，即可在 O(n^2) 时间复杂度内找到答案。

但是 O(n^2) 时间还是有些过高了，因此思考有没有办法继续优化呢？

优化 2.0

观察 O(n^2) 的解法，不难发现我们用了 O(n) 的时间复杂度才求出了固定某个点为区间右端点时，区间最大价值和。

例如固定了 n 为区间右端点后，我们通过从 n 到 1 枚举左端点，才求出了以 n 为区间右端点时的区间最大价值和，即 O(n) 的时间复杂度。

那么继续思考，「以 n 为区间右端点的区间最大和」，与「以 n - 1 为区间右端点的区间最大和」，这两者是否有关联呢？

为了描述方便，接下来我们用 f[i] 来代替「以 i 为区间右端点的区间最大和」，用  a[i] 来代替第 i 块宝石的价值。

不难发现，如果 f[n - 1] 为正数，则 f[n] 一定等于 f[n - 1] + a[n]；如果 f[n - 1] 为负数，则 f[n] 一定等于 a[n]。因此我们可以推导出如下转移方程：


根据上述转移方程，我们可以在 O(n) 时间复杂度内求出最大的 f[i]，即将此题时间复杂度优化到 O(n)，而这个优化的过程就是「动态规划」的过程。

在上述推导过程中，一共分为两步：

1. 将整个问题划分为一个个子问题，并令 f[i] 为第 i 个子问题的答案

2. 思考大规模的子问题如何从小规模的子问题推导而来，即如何由 f[i - 1] 推出 f[i]

这两个步骤便是「动态规划」解题思路的核心所在，即确定动态规划时的「状态」与「转移方程」。

